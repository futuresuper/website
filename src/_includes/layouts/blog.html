{% extends "layouts/base.html" %}

{% set pageHeaderTitle = title %}

{# If this is a tag, grab those items instead as one large collection #}
{% if tag %}
  {% set postListItems = collections[tag] %}
  {% set summary = 'Blog posts filed under “' + tag + '”' %}
{% endif %}

{% block content %}
  <article class="container">
    {% include "partials/page-header.html" %}
    <!-- Loops through and presents posts, such as blog posts -->
    <div>
      {% for post in collections.blog %}
        {# SET YEAR & MONTH VALS #}
        {% set year = post.date | year %}
        {% set month = post.date | month %}

        {# HORIZONTAL LINE FOR NEW MONTH #}
        {% if loop.index !== 1 %}
          {% if month !== lastMonth %}
            <div></div>
            <div class="hr"></div>
          {% endif %}
        {% endif %}

        {# PRINT YEAR IF NOT REPEAT OF PREVIOUS #}
        {% if year === lastYear %}
          <div></div>
        {% else %}
          <h2>{{ year }}</h2>
        {% endif %}
        {% set lastYear = post.date | year %}

        {# PRINT MONTH IF NOT REPEAT OF PREVIOUS #}
        {% if month === lastMonth %}
          <div></div>
        {% else %}
          <h3>{{ month }}</h3>
        {% endif %}
        {% set lastMonth = post.date | month %}

        {# IMAGE #}
        {% if post.data.image %}
          <a href="{{ post.url }}">
            <img src="{{ post.data.image }}" alt="{{ post.data.title }}" loading="lazy">
          </a>
        {% else %}
          <div class="image-placeholder"></div>
        {% endif %}

        {# TITLE + TEXT #}
        <a href="{{ post.url }}">
          <h3>{{ post.data.title }}</h3>
          <p>{{ post.data.summary }}</p>
          <p>{{ post.data.author }}</p>
          <p>
            {% for tag in post.data.tags %}
              {{ tag }}
              {% if loop.last === false %}
                {{ " • " }}
              {% endif %}
            {% endfor %}
          </p>

        </a>
      {% endfor %}
    </div>

  </article>

  {% include "partials/join-cta.html" %}
{% endblock %}